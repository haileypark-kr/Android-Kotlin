# Fragment

#### Fragment란

- Fragment activity 내의 어떤 동작 또는 사용자 인터페이스 일부
    - ==> activity의 부속으로 사용되는데, 화면을 그릴 때도 사용된다.
- 여러 개의 fragment 를 하나의 액티비티에 결합하여 창이 여러 개인 UI를 빌드할 수 있으며, 하나의 fragment를 여러 액티비티에서 재사용할 수 있다.
- fragment는 액티비티의 모듈식 섹션이라고 생각하면 됨
    - 재사용 가능
    - 다른 액티비티에 재사용할 수 있는 **하위 액티비티** 같은 개념
- 자체적인 수명주기를 가지며, 자체 입력 이벤트 수신
    - 동일하진 않고, fragment가 좀 더 수명주기 단계가 많음
    - fragment activity (이 fragment가 들어있는 액티비티) 의 수명주기에 직접적으로 영향을 받음

#### 생명주기

fragment의 생명주기는 액티비티의 생명주기를 반드시 따라간다. 액티비티에 종속적이기 때문에.

1. onAttach: fragment가 액티비티와 연결되어 있는 경우 호출. 액티비티가 전달된다.
2. onCreate: fragment를 생성할 때 시스템에서 호출. 초기화 작업을 하지만 view를 그리진 않는다.
3. onCreateView: fragment가 자신의 화면을 처음으로 그린다.
    - 리턴값으로 view를 반환해야 함.
    - UI를 제공하지 않는 fragment라면 null을 반환해야 함.
4. onPause: 사용자가 fragment를 떠난다는 첫 번째 신호
6. onDetach: fragment를 액티비티에서 끊어지는 **중**일 때 호출

#### 생성 방법

1. xml
2. 코드: 데이터 전달 / 동적 생성 시

#### 액티비티와 fragment 간 통신 방법

- Activity -> fragment : Bundle로 전달

```kotlin
// FragmentActivity.kt

(findViewById<TextView>(R.id.tv_attach)).setOnClickListener {
    Log.d("FragmentActivity", "click attach")

    val transaction = fragmentManager.beginTransaction() // 작업의 시작

    // fragment에 데이터 전달하는 방법 : Bundle 사용하여 fragment의 argument로 등록
    // 데이터를 넘겨야 하는 일이 있으면 xml이 아닌 코드로 fragment 생성
    val bundle = Bundle()
    bundle.putString("key", "hello")
    fragment1.arguments = bundle

    transaction.replace(R.id.linearlayout_root, fragment1)

    transaction.commit() // 여기까지 작업 커밋해라

    /*
    commit 종류
    1. commit : 앱이 상태를 저장한 경우, commit 시 IllegalStateException 발생해서 실행할 수 없음. commit을 바로 실행하진 않고 main thread에 예약.
    2. commitAllowingStateLoss : 저장한 경우 예외가 발생하지 않고 그냥 손실
    3. commitNow : commit 바로 실행.
    4. commitNowAllowingStateLoss
     */
}


// Fragment1.kt
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)

    // 데이터 받아오기
    val string: String? = arguments?.getString("key")
    Log.d("Fragment1", "data : $string")
}
```

- fragment -> activity : fragment의 함수 호출 (activity가 생성된 후에 하는 것이 좋음.)

```kotlin

// Fragment1.kt
override fun onCreateView(
    inflater: LayoutInflater,
    container: ViewGroup?,
    savedInstanceState: Bundle?
): View? {
    // container의 자식 뷰로 fragment를 넣어줌.
    // 세번째 파라미터 attachToRoot: 루트 view에 붙일지말지가 아니라, true면 바로 붙고 false는 때가 되면..=> addView 배우면 나옴

    return inflater.inflate(R.layout.fragment1, container, false)

}


override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)


    (view.findViewById<TextView>(R.id.tv_callActivity)).setOnClickListener {
        val string: String? = arguments?.getString("key")

        if (string != null) {
            (activity as FragmentActivity).doLog(string)
        }
    }
}

```