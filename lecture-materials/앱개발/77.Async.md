# Async

#### AsyncTask

지금은 deprecated ==> coroutine / RXJava 사용

- 단점: 이미 execute된 asyncTask는 다시 execute 못함.

```kotlin

class BackgroundAsyncTask(
    val progressBar: ProgressBar, val progressText: TextView
) : AsyncTask<Int, Int, Int>() {

    /*
    AsyncTask<Params, Progress, Result>
    - Params: doInBackground 에서 사용
    - Progress: onProgressUpdate 에서 사용
    - Result: onPostExecute 에서 사용
     */

    var percent: Int = 0

    override fun doInBackground(vararg p0: Int?): Int {
        while (!isCancelled && percent < 100) {
            percent++
            Thread.sleep(10)
            publishProgress(percent) // 진행도 업데이트. 업데이트하고 나면 onProgressUpdate 실행됨.
        }

        return percent
    }

    override fun onPreExecute() {
        percent = 0
        progressBar.progress = percent
    }

    // 비동기 작업 완료 후
    override fun onPostExecute(result: Int?) {
        progressText.text = "작업이 완료되었습니다."
    }

    override fun onCancelled() {
//        progressBar.progress = 0
        progressText.text = "작업이 취소되었습니다."
    }

    override fun onProgressUpdate(vararg values: Int?) {
        val updatedPercent = values[0] ?: 0
        progressBar.progress = updatedPercent
        progressText.text = "$updatedPercent%"
    }
}
```